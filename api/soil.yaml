openapi: '3.0.3'
info:
  title: Food Production Common API
  description: Food Production Common API based on Reference Architectural Model Industrie 4.0 (RAMI 4.0)
  version: 1.0.0
servers:
  - url: http://localhost:8000/
paths:
  /soil/nutrients:
    get:
      responses:
        '200':
          description: 'Example'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Nutrient'

    post:
      summary: Soil nutrient measurement event
      description: |
          Raw sensor payment received in the integration layer and converted into 
          this common model to generate an event for the information layer.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Nutrient'
            examples:
              NutrientExample:
                $ref: '#/components/examples/NutrientExample'
          application/xml:
            schema:
              $ref: '#/components/schemas/Nutrient'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Nutrient'
      responses:
        '201':
          description: Event successfully sent
  /soil/conditions:
    post:
      summary: Soil conditions measurement event
      description: |
        Raw sensor payment received in the integration layer and converted into 
        this common model to generate an event for the information layer.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Condition'
          application/xml:
            schema:
              $ref: '#/components/schemas/Condition'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Condition'
      responses:
        '201':
          description: Event successfully sent

  /soil/compositions:
    post:
      summary: Soil composition measurement event
      description: |
        Raw sensor payment received in the integration layer and converted into 
        this common model to generate an event for the information layer.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Composition'
          application/xml:
            schema:
              $ref: '#/components/schemas/Composition'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Composition'
      responses:
        '201':
          description: Event successfully sent
  /weather/temperature:
    post:
      summary: Soil composition measurement event
      description: |
        Raw sensor payment received in the integration layer and converted into 
        this common model to generate an event for the information layer.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Temperature'
          application/xml:
            schema:
              $ref: '#/components/schemas/Temperature'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Temperature'
      responses:
        '201':
          description: Event successfully sent
  /weather/precipitation:
    post:
      summary: Soil composition measurement event
      description: |
        Raw sensor payment received in the integration layer and converted into 
        this common model to generate an event for the information layer.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Precipitation'
          application/xml:
            schema:
              $ref: '#/components/schemas/Precipitation'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Precipitation'
      responses:
        '201':
          description: Event successfully sent
components:
  schemas:
    Header:
      type: object
      properties:
        sensorId:
          type: string
          format: uuid
        time:
          type: string
          format: date-time
        fieldId:
          type: string
          format: uuid
        farmId:
          type: string
          format: uuid
    Nutrient:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        phosphorus:
          type: number
          description: ppm
        nitrogen:
          type: number
          description: ppm
        potassium:
          type: number
          description: ppm
        calcium:
          type: number
          description: ppm
        magnesium:
          type: number
          description: ppm
        sulfur:
          type: number
          description: ppm
        salt:
          type: number
          description: |
            Soil salinity is measured in units of electrical conductivity (EC), which is also known as Siemens (S).
            The most common units of EC are deciSiemens per meter (dS/m)
        cationExchangeCapacity:
          type: number
          description: |
            moving ions in the soil based on how much salt and how much water is in the soil.
        zinc:
          type: number
          description: ppm
        iron:
          type: number
          description: ppm
        nutrientDeficiency:
          type: array
          items:
            type: string
    Composition:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        organicMass:
          type: number
          minimum: 0
          maximum: 100
          description: biomass as a % of soil
        heavyMetals:
          type: number
          description: ug/kg or ppb
        granularity:
          type: number
          description: |
            Percentage of fine grains to weight
            Higher percentage of file grains means the soil is more cohesive (more clay).
            Lower % of fine grains mean the soil is more granular
        soilGranularityType:
          type: string
          enum: [ Gravel, Very coarse, Coarse, Medium, Fine, Very fine, ]
          description: |
            Gravel: >2.0mm
            Very coarse: 1.0 - 2.0mm
            Coarse: 0.50 - 1.0mm
            Medium: 0.25 - 0.50mm
            Fine: 0.10 - 0.25mm
            Very fine: 0.05 - 0.10mm
        clay:
          type: number
          description: % of soil is clay
        sand:
          type: number
        silt:
          type: number
    Condition:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        soilHumidity:
          type: number
          minimum: 0
          maximum: 100
          description: Volumetric water content
        ph:
          type: number
          minimum: 0
          maximum: 14
        sunlight:
          type: number
          description: W/m^2
        soilTemperature:
          type: number
          description: Â°C
        waterDeficiency:
          type: number
    Temperature:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        timing:
          type: string
          format: date-time
        dailyAirTempertaure:
          type: number
          description: maximum air temperature of the day in Celius
        duration:
          type: number
        minimalAirTemperatureSeason:
          type: number
          description: minimum air temperature recorded during the growing season in Celius .
        maximumAirTemperatureSeason:
          type: number
          description: maximum air temperature recorded during the growing season in Celius .
        averageAirTemperatureSeason:
          type: number
          description: average air temperature recorded during the growing season in Celius .
        growingDegreeDays:
          type: number
          description: number of days in the seasons above the growing threshold for the crop.
    Precipitation:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        timing:
          type: string
          format: date-time
        amount:
          type: number
        duration:
          type: number
        distribution:
          type: string
        evapotranspiration:
          type: number
        intensity:
          type: string
        variability:
          type: string
        daysSinceLastPrecepitation:
          type: number
        totalRainyDaysInSeason:
          type: number
        averageRainyDaysInSeason:
          type: number
        averagePotentialEvapotranspiration:
          type: number
        averageVaporPresureDeficit:
          type: number
    Plant:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        weedSpatialOccurance:
          type: number
          description: average distance
        plantSpatialArrangement:
          type: number
          description: average distance
        outcrossingAndSelfPollination:
          type: string
          enum: [ CROSS, SELF, BOTH ]
        cloneSize:
          type: number
        fruitSet:
          type: number
          description: days
    Animal:
      type: object
      properties:
        header:
          $ref: '#/components/schemas/Header'
        beeComposition:
          type: array
          items:
            type: object
            properties:
              beeType:
                type: string
              beeTypePercentage:
                type: number
        beeDensity:
          type: number
        beneficialInsectComposition:
          type: number
        harmfulInsectComposition:
          type: number
        diseasePrevalence:
          type: number
        microbialActivity:
          type: number
          description: mg/kg
  examples:
    NutrientExample:
      value: {
        "header": {
          "sensorId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
          "time": "2024-03-27T17:33:31.482Z",
          "fieldId": "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        },
        "phosphorus": 5,
        "nitrogen": 12,
        "potassium": 8,
        "calcium": 8,
        "magnesium": 5,
        "sulfur": 1,
        "salt": 12,
        "zinc": 2,
        "iron": 4
      }


